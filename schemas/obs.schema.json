{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "RLMDSL Observation",
  "type": "object",
  "required": [
    "schema_version",
    "cell",
    "status",
    "vars_delta",
    "budgets",
    "events",
    "errors",
    "truncated"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Pinned version of the observation schema, e.g., 'obs-0.1'."
    },
    "cell": {
      "type": "object",
      "required": ["name", "index"],
      "properties": {
        "name": { "type": "string" },
        "index": { "type": "integer" }
      }
    },
    "status": {
      "type": "string",
      "enum": ["ok", "error", "budget_exceeded", "capability_denied"]
    },
    "vars_delta": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "required": ["kind", "v"],
        "properties": {
          "kind": { "type": "string", "enum": ["TEXT", "INT", "BOOL", "JSON", "SPAN", "BYTES", "LIST"] },
          "v": {}
        }
      },
      "description": "Variables created or updated in this execution turn."
    },
    "result": {
      "description": "Optional primary value for the cell.",
      "type": ["object", "null"]
    },
    "final": {
      "description": "The final typed value if SET_FINAL occurred.",
      "type": ["object", "null"]
    },
    "budgets": {
      "type": "object",
      "description": "Remaining and consumed counters for resource budgets."
    },
    "events": {
      "type": "array",
      "items": { "type": "object" },
      "description": "Structured trace events for debugging and auditing."
    },
    "errors": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["code", "message"],
        "properties": {
          "code": { "type": "string" },
          "message": { "type": "string" },
          "loc": {
            "type": "object",
            "properties": {
              "file": { "type": "string" },
              "line": { "type": "integer" },
              "col": { "type": "integer" }
            }
          },
          "hint": { "type": "string" }
        }
      }
    },
    "truncated": {
      "type": "object",
      "required": ["obs", "prints", "previews"],
      "properties": {
        "obs": { "type": "boolean" },
        "prints": { "type": "boolean" },
        "previews": { "type": "boolean" }
      }
    }
  }
}
