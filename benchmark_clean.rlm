RLMDSL 0.2

TASK default:
  REQUIRES capability="llm"
  REQUIRES capability="fs_read"
  CELL parse_basic:
    PRINT SOURCE "hello"
    SET_FINAL SOURCE true
  CELL indent_wrong:
    PRINT SOURCE "wrong"
  CELL literals:
    PRINT SOURCE null
    SET_FINAL SOURCE -42
  CELL escapes:
    SET_FINAL SOURCE "line1\nline2\ttab"
  CELL budget:
    PRINT SOURCE 1
    PRINT SOURCE 2
    PRINT SOURCE 3
  CELL safety:
    READ_FILE PATH "/etc/passwd" INTO out: TEXT
    SET_FINAL SOURCE out
  CELL recursion:
    SUBCALL SOURCE PROMPT TASK "recursive" DEPTH_COST 10 INTO out_2: JSON
    SET_FINAL SOURCE out
  CELL credentials:
    JSON_PARSE SOURCE "{\"user\": \"admin\", \"pass\": \"hunter2\"}" INTO out_3: JSON
    SET_FINAL SOURCE out
  CELL find_error:
    FIND_TEXT SOURCE PROMPT NEEDLE "ERROR" MODE FIRST IGNORE_CASE false INTO pos: OFFSET
    ASSERT COND true MESSAGE "Found error"
    SET_FINAL SOURCE pos
  CELL config_extract:
    FIND_REGEX SOURCE PROMPT PATTERN "\\{.*\\}" MODE FIRST INTO span: SPAN
    GET_SPAN_START SOURCE span INTO start: OFFSET
    GET_SPAN_END SOURCE span INTO end: OFFSET
    SLICE_TEXT SOURCE PROMPT START start END end INTO snippet: TEXT
    JSON_PARSE SOURCE snippet INTO cfg: JSON
    SET_FINAL SOURCE cfg
  CELL recursive_summary:
    FIND_TEXT SOURCE PROMPT NEEDLE "Chapter 1" MODE FIRST IGNORE_CASE true INTO p1: OFFSET
    WINDOW_TEXT SOURCE PROMPT CENTER p1 RADIUS 100 INTO s1: TEXT
    SUBCALL SOURCE s1 TASK "Summarize chapter 1" DEPTH_COST 1 INTO r1: JSON
    SET_FINAL SOURCE r1
  OUTPUT r1
